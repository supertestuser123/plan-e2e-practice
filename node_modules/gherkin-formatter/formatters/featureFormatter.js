"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.format = void 0;
const gherkin_ast_1 = require("gherkin-ast");
const debug_1 = require("../debug");
const lines_builder_1 = require("lines-builder");
const backgroundFormatter_1 = require("./backgroundFormatter");
const ruleFormatter_1 = require("./ruleFormatter");
const scenarioFormatter_1 = require("./scenarioFormatter");
const scenarioOutlineFormatter_1 = require("./scenarioOutlineFormatter");
const tagFormatter_1 = require("./tagFormatter");
const debug = (0, debug_1.getDebugger)("featureFormatter");
function format(feature, options) {
    debug("format(feature: %s, options: %o)", feature === null || feature === void 0 ? void 0 : feature.constructor.name, options);
    if (!feature) {
        throw new Error("Feature must be set!");
    }
    const l = (0, lines_builder_1.lines)(`${feature.keyword}: ${feature.name}`);
    if (feature.precedingComment) {
        l.prepend(feature.precedingComment.text);
    }
    if (feature.tags.length > 0) {
        l.prepend((0, tagFormatter_1.format)(feature.tags, options));
    }
    if (feature.tagComment) {
        l.prepend(feature.tagComment.text);
    }
    if (feature.description) {
        l.append((0, lines_builder_1.lines)({ trimLeft: true }, feature.description));
    }
    if (feature.descriptionComment) {
        l.append((0, lines_builder_1.lines)(null, feature.descriptionComment.text));
    }
    if (feature.elements.length > 0) {
        feature.elements.forEach((item) => {
            if (item instanceof gherkin_ast_1.Scenario) {
                l.append(null, (0, lines_builder_1.lines)((0, scenarioFormatter_1.format)(item, options)));
            }
            else if (item instanceof gherkin_ast_1.ScenarioOutline) {
                l.append(null, (0, lines_builder_1.lines)((0, scenarioOutlineFormatter_1.format)(item, options)));
            }
            else if (item instanceof gherkin_ast_1.Background) {
                l.append(null, (0, lines_builder_1.lines)((0, backgroundFormatter_1.format)(item, options)));
            }
            else if (item instanceof gherkin_ast_1.Rule) {
                l.append(null, (0, lines_builder_1.lines)((0, ruleFormatter_1.format)(item, options)));
            }
        });
    }
    if (feature.language !== 'en') {
        l.prepend(`# language: ${feature.language}`);
    }
    return l.toString();
}
exports.format = format;
//# sourceMappingURL=featureFormatter.js.map